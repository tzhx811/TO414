---
title: "KNN Model"
author: "Xincheng Yuan"
date: "4/9/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
stroke <- read.csv("healthcare-dataset-stroke-data.csv")
stroke <- stroke[stroke$gender != "Other",]
stroke$id <- NULL
stroke$gender <- as.factor(stroke$gender)
stroke$work_type <- as.factor(stroke$work_type)
stroke$smoking_status <- as.factor(stroke$smoking_status)
stroke$ever_married <- as.factor(stroke$ever_married)
stroke$Residence_type <- as.factor(stroke$Residence_type)
stroke$heart_disease <- as.factor(stroke$heart_disease)
stroke$bmi <- as.numeric(stroke$bmi)
```

```{r}
summary(stroke)
normalize <- function(x) {
  return ((x - min(x)) / (max(x) - min(x)))
}

strokemm <- as.data.frame(model.matrix(~.-1,stroke))
stroke_norm <- as.data.frame(lapply(strokemm, normalize))
```

##KNN Model
```{r}
set.seed(12345)
testrows_knn <- sample(1:nrow(stroke_norm), 1280) 
stroketrain_knn <- stroke_norm[-testrows_knn, ]
stroketest_knn <- stroke_norm[testrows_knn, ]

knn_train_labels <- stroke_norm[-testrows_knn, "stroke"]
knn_test_labels <- stroke_norm[testrows_knn, "stroke"]
```

```{r}
library(class)
library(caret)
stroke_knn_test_pred <- knn(train = stroketrain_knn, test = stroketest_knn,
                      cl = knn_train_labels, k= sqrt(sqrt(nrow(stroketrain_knn))))

library(caret)
confusionMatrix(as.factor(stroke_knn_test_pred), as.factor(knn_test_labels))
```