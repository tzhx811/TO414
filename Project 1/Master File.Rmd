---
title: "Master File"
author: "Yusuf Uzhunnan, Tony Zhao, Jenny Yu, Evan Jiang, Xincheng Yuan"
date: "2/20/2021"
output: html_document
---
# Data Loading and Cleaning. Loading Important Packages
```{r}
library("ggplot2")
library("dplyr")
hotel_bookings = read.csv("hotel_bookings.csv")
hotel_bookings$is_repeated_guest = as.factor(hotel_bookings$is_repeated_guest)
hotel_bookings$company = as.factor(hotel_bookings$company)
hotel_bookings$hotel = as.factor(hotel_bookings$hotel)
hotel_bookings$arrival_date_month = as.factor(hotel_bookings$arrival_date_month)
hotel_bookings$arrival_date_year = as.factor(hotel_bookings$arrival_date_year)
hotel_bookings$meal = as.factor(hotel_bookings$meal)
hotel_bookings$country = as.factor(hotel_bookings$country)
hotel_bookings$market_segment = as.factor(hotel_bookings$market_segment)
hotel_bookings$distribution_channel = as.factor(hotel_bookings$distribution_channel)
hotel_bookings$reserved_room_type = as.factor(hotel_bookings$reserved_room_type)
hotel_bookings$assigned_room_type = as.factor(hotel_bookings$assigned_room_type)
hotel_bookings$agent = as.factor(hotel_bookings$agent)
hotel_bookings$reservation_status_date = as.factor(hotel_bookings$reservation_status_date)
hotel_bookings$reservation_status = as.factor(hotel_bookings$reservation_status)
hotel_bookings$customer_type = as.factor(hotel_bookings$customer_type)
hotel_bookings$deposit_type = as.factor(hotel_bookings$deposit_type)
```


# Most frequent customer original countries
```{r}
##Load the data
hotel_bookings$country <- as.character(hotel_bookings$country)
countryorigin <- hotel_bookings[,c(1,14)]

##Transform 3 digit codes into country names
library(countrycode)
countryorigin$country <- countrycode(countryorigin$country, "iso3c", "country.name", nomatch = NULL)
countryorigin$country <- as.factor(countryorigin$country)

```

## Customer Origin at Resort Hotel
```{r}
originofRH <- countryorigin[countryorigin$hotel == "Resort Hotel",]
RH <- table(originofRH$country)
barplot((sort(RH, decreasing = TRUE))[1:6], main = "Top 6 Countries of Customer Origin at Resort Hotel", ylab = "# of visitors", col=c("red", "white", "yellow", "green", "blue", "orange"), cex.names = 0.8)
```

The Resort Hotel has more foreign customers from UK(#2) and Ireland(#4). Many families from Northern Europe choose to spend their holidays at Iberian peninsula, where has warmer weather comparing to their home countries. We also see visitors from Spain(#3) and France(#5) due to geographical closeness.

## Customer Origin at City Hotel
```{r}
originofC <- countryorigin[countryorigin$hotel == "City Hotel",]
CH <- table(originofC$country)
barplot((sort(CH, decreasing = TRUE))[1:6], main = "Top 6 Countries of Customer Origin at City Hotel", ylab = "# of visitors", col=c("red", "blue", "orange", "white", "yellow", "dark green"), cex.names = 0.8)
```

At City Hotel, we see most foreign customers from France, Germany, UK, Spain, and Italy. Those 5 countries are also the 5 countries with the highest GDP in the European Union (before Brexit). Given that a lot of City Hotel customers travel for business purposes, it makes sense that those customers are coming from the bigger economies of EU and come to Portugal to handle their business. 

**Summary:**
Most customers are coming from Portugal at both Resort Hotel and City Hotel, so there is a high chance that both hotels are based in Portugal. The top 6 countries of origin are all European countries with some variation in rankings among 2 hotels.

# Customer Satisfaction/Loyalty
## Percentage of Repeated Guests
It would be helpful for us to determine customer satisfaction & loyalty by looking deep into the repeated guest data and their respective cancellation rate 
```{r}
repeatedguestportion <- tapply(hotel_bookings$is_repeated_guest, hotel_bookings$hotel, mean, na.rm = TRUE)
round(repeatedguestportion, digits = 3)
```
Resort Hotel tend to have more repeated guests than City Hotel.
```{r}
barplot(repeatedguestportion, col=c("blue","orange"), border =TRUE, axes= TRUE, ylim=c(0,0.05), main = "Percentage of repeated guest by hotel")
```

Both hotels have relatively low percentage of repeated guests (less than 5%), which projects low satisfaction and loyalty. 

##Cancellation Rate of Repeated Guests
```{r}
hotel_bookings$repeatedFact <- as.factor(hotel_bookings$is_repeated_guest)
temp_t1 <- aggregate(is_canceled ~ repeatedFact + hotel, data = hotel_bookings, mean)
barplot(temp_t1$is_canceled, names.arg = c("City Non-Repeated", "City Repeated", "Resort Non-Repeated", "Resort Repeated"), col=c("dark blue","blue","dark orange","orange"), border =TRUE, axes= TRUE, ylim=c(0,0.5), cex.names = 0.8, main = "Repeated & Non-Repeated Guest Cancelleation rate by hotel")

```